#!/bin/sh

# Commmand line options
#
#    -a <opt> - The local hostname that the server listens on.
#    -p <opt> - The local port that the server listens on (default: 55553).
#    -U <opt> - The username to access the server.
#    -P <opt> - The password to access the server.
#    -S - Enables or disables SSL on the RPC socket. (default: true)
#    -f - Runs the daemon in the foreground.

USERNAME=msf
PASSWORD=welcome1
PORT=55552
OPTIONS="-S false -f"

MSF4DIR=${HOME}/.msf4

if [ -d ${MSF4DIR} ]; then
    docker run \
        --network host \
        -it \
        --rm \
        --name metasploit-api \
        -v ${MSF4DIR}:/home/msf/.msf4 \
        metasploitframework/metasploit-framework:latest \
        ./msfrpcd -P ${PASSWORD} -U ${USERNAME} -p ${PORT} ${OPTIONS}
else
    docker run \
        --network host \
        -it \
        --rm \
        --name metasploit-api \
        metasploitframework/metasploit-framework:latest \
        ./msfrpcd -P ${PASSWORD} -U ${USERNAME} -p ${PORT} ${OPTIONS}
fi 